{"version":3,"sources":["cljs_test_display/favicon.cljs"],"mappings":";AAMA;;;AAAA,AAAAA,AAAA,AAAA,AAAaC;AAEb,AAAA,AAAMC,AAAsBC;AAA5B,AACE,AAAA,AAAAC,AAACC;AAAD,AAAM,AAAAD,AAAOD;AAAa,AAACG,AAAM,AAAUH;;AAE7C,AAAA,AAAMI;AAAN,AACE,AAACC,AACA,AAACC,AACA,AAAKC;AAAL,AACE,AAAAC,AAAe,AAAOD;AAAtB,AAAA,AAAAC;AAAA,AAAA,AAAAA,AAAWC;AAAX,AACE,AAAA,AAAAC,AAACC;AAAD,AAAO,AAAA,AAAAD,AAACE;AAAY,AAAA,AAACC,AAAaJ;;AADpC;;AAEF,AAACV,AAAqB,AAAA,AAACe;;AAE3B,AAAA,AAAMC,AAAYR;AAAlB,AACE,AAAM,AAAMA,AAAGT;;AACf,AAAA,AAAM,AAAOS;;AACb,AAAA,AAAM,AAAQA;;AACd,AAAA,AAAM,AAAQA;;AAEhB,AAAA,AAAMS;AAAN,AACE,AAAAC,AAAiB,AAACE,AAAgBrB;AAAlC,AAAA,AAAAmB;AAAA,AAAAA,AAASC;AAAT,AACEA;;AACA,AAAAD,AAAiB,AAACb;AAAlB,AAAA,AAAAa;AAAA,AAAAA,AAASC;AAAT,AACE,AAAI,AAACH,AAAWG;;AACZA;;AACJ,AAAMA,AAAQ,AAAA,AAACE;AAAf,AACE,AAACL,AAAWG;;AACR,AAACG,AACD,AAAA,AAACC,AACD,AAACC,AAAiBL;;AACtBA;;;;AAER,AAAA,AAAMM,AAAgBC,AAAMC;AAA5B,AACE,AAAMC,AAAI,AAAA,AAAA,AAACP,AAAoCM,AAAaA;AAA5D,AACE,AAAME,AAAI,AAAA,AAAaD;AAAvB,AACE,AAAM,AAAaC,AAAKH;;AACxB,AAAA,AAAA,AAAWG,AAAQF,AAAKA;;AAC1B,AAAYC;;AAEhB,AAAA,AAAME,AAAiBJ;AAAvB,AACE,AAAM,AAAQ,AAACT,AAAiB,AAAA,AAACQ,AAAeC;;AAElD,AAAA,AAAMK;AAAN,AAAe,AAAA,AAACD;;AAEhB,AAAA,AAAME;AAAN,AAAa,AAAA,AAACF","names":["js/goog.define","cljs-test-display.favicon/link-id","cljs-test-display.favicon/html-collection->seq","html-coll","p1__37414#","cljs.core.map","cljs.core.range","cljs-test-display.favicon/find-existing-link","cljs.core/first","cljs.core.filter","l","temp__5735__auto__","rel","p1__37418#","cljs.core/some","cljs.core._EQ_","clojure.string.split","goog.dom/getElementsByTagName","cljs-test-display.favicon/init-link!","cljs-test-display.favicon/get-or-create!","temp__5733__auto__","favicon","goog.dom/getElement","goog.dom/createDom","goog.dom/getDocument","goog.object/get","goog.dom/appendChild","cljs-test-display.favicon/color-data-url","color","size","cvs","ctx","cljs-test-display.favicon/change-to-color","cljs-test-display.favicon/green","cljs-test-display.favicon/red"],"sourcesContent":["(ns cljs-test-display.favicon\n  (:require\n   [clojure.string :as string]\n   [goog.object :as gobj]\n   [goog.dom :as gdom]))\n\n(goog-define link-id \"cljs-test-favicon\")\n\n(defn html-collection->seq [html-coll]\n  (map #(.item html-coll %) (range (.-length html-coll))))\n\n(defn find-existing-link []\n  (first\n   (filter\n    (fn [l]\n      (when-let [rel (.-rel l)]\n        (some #(= \"icon\" %) (string/split rel #\"\\s\"))))\n    (html-collection->seq (gdom/getElementsByTagName \"link\")))))\n\n(defn init-link! [l]\n  (set! (.-id l) link-id)\n  (set! (.-rel l) \"shortcut icon\")\n  (set! (.-type l) \"image/png\")\n  (set! (.-href l) \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAIElEQVQ4T2NMS0v7z0ABYBw1gGE0DBhGwwCYh4ZBOgAAcQUjIUXh8RYAAAAASUVORK5CYII=\"))\n\n(defn get-or-create! []\n  (if-let [favicon (gdom/getElement link-id)]\n    favicon\n    (if-let [favicon (find-existing-link)]\n      (do (init-link! favicon)\n          favicon)\n      (let [favicon (gdom/createDom \"link\")]\n        (init-link! favicon)\n        (-> (gdom/getDocument)\n            (gobj/get \"head\")\n            (gdom/appendChild favicon))\n        favicon))))\n\n(defn color-data-url [color size]\n  (let [cvs (gdom/createDom \"canvas\" #js {:width size :height size})]\n    (let [ctx (.getContext cvs \"2d\")]\n      (set! (.-fillStyle ctx) color)\n      (.fillRect ctx 0 0 size size))\n    (.toDataURL cvs)))\n\n(defn change-to-color [color]\n  (set! (.-href (get-or-create!)) (color-data-url color 16)))\n\n(defn green [] (change-to-color \"#0d0\"))\n\n(defn red [] (change-to-color \"#d00\"))\n"]}